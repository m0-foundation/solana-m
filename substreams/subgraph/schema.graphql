type TokenHolder @entity {
    id: Bytes! # owner pubkey
    mint: Bytes!
    user: Bytes! @unique
    balance: BigInt!
    token_accounts: [TokenAccount!]! @derivedFrom(field: "owner")
}

type TokenAccount @entity {
    id: Bytes! # token account pubkey
    pubkey: Bytes! @unique
    owner: TokenHolder!
    balance: BigInt!
    claims: [Claim!]! @derivedFrom(field: "token_account")
    cumulative_claims: BigInt!
    transfers: [BalanceUpdate!]! @derivedFrom(field: "token_account")
}

type Claim @entity(immutable: true) {
    id: Bytes! # claim-<signature>
    amount: BigInt!
    ts: Timestamp!
    token_account: TokenAccount!
    recipient_token_account: TokenAccount!
}

type BalanceUpdate @entity(immutable: true) {
    id: Bytes! # balance-update-<signature>
    amount: BigInt!
    ts: Timestamp!
    token_account: TokenAccount!
}

type IndexUpdates @entity {
    id: Bytes! # index-updates
    updates: [IndexUpdate!]! @derivedFrom(field: "updates")
    last_index: BigInt!
    last_ts: Timestamp!
}

type IndexUpdate @entity(immutable: true) {
    id: Bytes! # index-udpate-<signature>
    index: BigInt!
    ts: Timestamp!
    updates: IndexUpdates!
}

type Timestamp @entity(immutable: true) {
    id: Bytes! # signature
    ts: BigInt!
    block: BigInt!
    signature: Bytes!
}
