name: test
on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  program-tests:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Environment
        uses: ./.github/setup

      - name: Run tests
        run: yarn test
        shell: bash

  sdk-tests:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Environment
        uses: ./.github/setup

      - name: Install SDK Dependencies
        run: cd sdk && yarn install && cd ..
        shell: bash

      - name: Run SDK tests
        run: make test-sdk
        shell: bash

  yield-bot-tests:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Node Dependencies
        run: npm i -g yarn && yarn install
        shell: bash

      - name: Install SDK Dependencies
        run: cd sdk && yarn install && cd ..
        shell: bash

      - name: Run yield tests
        run: make test-yield-bot
        shell: bash
